<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <style type="text/tailwindcss">
      @theme {
        --font-title: "roboto", sans-serif;
        --font-mono: "in", inconsolata;
        --color-pastel-blue: #d4f5ff;
        --color-pizza: #0000FF;
      }
    </style>

    <title>Squash's Trivia Page</title>
  </head>

  <body class="bg-linear-to-r from-green-300 to-violet-300">
    <nav>
      <a href="{{ url_for('home') }}">Home</a>
      <a href="{{ url_for('jokes') }}">Jokes</a>
      <a href="{{ url_for('trivia') }}">Trivia</a>
      <a href="{{ url_for('activities') }}">Activities</a>
      <a href="{{ url_for('logout') }}">Logout</a>
    </nav>

    <h2>trivia</h2>
    <p>logged in as {{ username }}</p>
    <hr>

    {% if stage == "choose" %}
      <h3>Choose Difficulty</h3>

      <form action="{{ url_for('trivia') }}" method="post">
        <button type="submit" name="difficulty" value="easy">Easy</button>
        <button type="submit" name="difficulty" value="medium">Medium</button>
        <button type="submit" name="difficulty" value="hard">Hard</button>
      </form>

    {% else %}
      <h3>Trivia Question:</h3>
      <p id="question"></p>

      <p>Difficulty: <span id="difficulty"></span></p>
      <p>Category: <span id="category"></span></p>

      <div id="message"></div>

      <p>Total Points: <span id="totalPoints">{{ points }}</span></p>

      <p>Answer Choices:</p>

      <form action="{{ url_for('trivia') }}" method="post" id="answerForm">
        <input type="hidden" name="current_difficulty" value="{{ chosen_difficulty }}">
        <div id="answers"></div>
      </form>

      <form action="{{ url_for('trivia') }}" method="post">
        <input type="hidden" name="current_difficulty" value="{{ chosen_difficulty }}">
        <button name="nextbtn" type="submit">Next</button>
      </form>

      <script>
        var triviaData = {{ trivia | tojson }};
        var q = triviaData.results[0];

        function decodeHtml(s) {
          var t = document.createElement("textarea");
          t.innerHTML = s;
          return t.value;
        }

        document.getElementById("question").textContent = decodeHtml(q.question);
        document.getElementById("difficulty").textContent = decodeHtml(q.difficulty);
        document.getElementById("category").textContent = decodeHtml(q.category);

        var correctRaw = q.correct_answer;
        var answersRaw = q.incorrect_answers.slice();
        answersRaw.push(correctRaw);

        for (var i = answersRaw.length - 1; i > 0; i--) {
          var j = Math.floor(Math.random() * (i + 1));
          var tmp = answersRaw[i];
          answersRaw[i] = answersRaw[j];
          answersRaw[j] = tmp;
        }

        var answered = false;
        var answersDiv = document.getElementById("answers");

        function disableAll() {
          var btns = answersDiv.querySelectorAll("button");
          btns.forEach(function(b) { b.disabled = true; });
        }

        answersRaw.forEach(function(ansRaw) {
          var btn = document.createElement("button");
          btn.type = "submit";
          btn.name = "answer";
          btn.value = ansRaw;
          btn.textContent = decodeHtml(ansRaw);

          btn.onclick = function() {
            if (answered) return false;
            answered = true;
            disableAll();
            return true;
          };

          answersDiv.appendChild(btn);
          answersDiv.appendChild(document.createTextNode(" "));
        });
      </script>
    {% endif %}
  </body>
</html>
